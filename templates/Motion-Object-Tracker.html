

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Object Tracking - Motion Analysis</title>
<script src="{{url_for('static' , filename='providers/frame/3.4.16')}}"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <style>
        .stat-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }
    </style>
</head>
<body class="bg-gray-100 min-h-screen">
    <div class="container mx-auto px-4 py-8">
        <!-- Header -->
        <div class="text-center mb-8">
            <h1 class="text-4xl font-bold text-gray-900 mb-3">
                <i class="fas fa-search-location text-blue-500 mr-3"></i>
                Object Tracking Details
            </h1>
            <p class="text-gray-600 text-lg">Job #{{ object_info.job_id }} â€¢ Object #{{ object_info.object_id }}</p>
            <div class="flex justify-center space-x-4 mt-4">
                <a href="/results/{{ object_info.job_id }}" class="bg-blue-500 hover:bg-blue-600 text-white px-6 py-2 rounded-lg transition-colors">
                    <i class="fas fa-arrow-left mr-2"></i>Back to Results
                </a>
                <a href="/" class="bg-gray-500 hover:bg-gray-600 text-white px-6 py-2 rounded-lg transition-colors">
                    <i class="fas fa-home mr-2"></i>Dashboard
                </a>
            </div>
        </div>

        <!-- Object Summary -->
        <div class="grid md:grid-cols-4 gap-6 mb-8">
            <div class="stat-card rounded-xl shadow-lg p-6 text-center">
                <i class="fas fa-route text-3xl mb-3 text-white"></i>
                <h3 class="text-2xl font-bold">{{ "%.1f"|format(object_info.total_distance) }} px</h3>
                <p class="text-blue-200">Total Distance</p>
            </div>
            
            <div class="stat-card rounded-xl shadow-lg p-6 text-center">
                <i class="fas fa-tachometer-alt text-3xl mb-3 text-white"></i>
                <h3 class="text-2xl font-bold">{{ "%.1f"|format(object_info.avg_speed) }}</h3>
                <p class="text-blue-200">Avg Speed</p>
            </div>
            
            <div class="stat-card rounded-xl shadow-lg p-6 text-center">
                <i class="fas fa-rocket text-3xl mb-3 text-white"></i>
                <h3 class="text-2xl font-bold">{{ "%.1f"|format(object_info.max_speed) }}</h3>
                <p class="text-blue-200">Max Speed</p>
            </div>
            
            <div class="stat-card rounded-xl shadow-lg p-6 text-center">
                <i class="fas fa-clock text-3xl mb-3 text-white"></i>
                <h3 class="text-2xl font-bold">{{ "%.1f"|format(object_info.duration) }}s</h3>
                <p class="text-blue-200">Duration</p>
            </div>
        </div>

        <div class="grid lg:grid-cols-2 gap-8">
            <!-- Trajectory Visualization -->
            <div class="bg-white rounded-xl shadow-lg p-6">
                <h2 class="text-2xl font-semibold mb-4 flex items-center">
                    <i class="fas fa-map-marked-alt text-green-500 mr-3"></i>
                    Trajectory Path
                </h2>
                {% if object_info.trajectory_points and object_info.trajectory_points|length > 0 %}
                <div class="border-2 border-gray-200 rounded-lg p-4 bg-gray-50">
                    <img src="/api/motion/object-trajectory/{{ object_info.job_id }}/{{ object_info.object_id }}" 
                         alt="Object Trajectory" class="w-full h-80 object-contain">
                </div>
                <div class="mt-3 text-center">
                    <button onclick="downloadTrajectory()" class="bg-green-500 hover:bg-green-600 text-white px-4 py-2 rounded">
                        <i class="fas fa-download mr-1"></i>Download Trajectory
                    </button>
                </div>
                {% else %}
                <div class="text-center py-12 text-gray-500">
                    <i class="fas fa-map-marker-alt text-4xl mb-3"></i>
                    <p>No trajectory data available</p>
                    <p class="text-sm">This object may not have sufficient tracking data</p>
                </div>
                {% endif %}
            </div>

            <!-- Detailed Information -->
            <div class="bg-white rounded-xl shadow-lg p-6">
                <h2 class="text-2xl font-semibold mb-4 flex items-center">
                    <i class="fas fa-info-circle text-blue-500 mr-3"></i>
                    Object Information
                </h2>
                
                <div class="space-y-4">
                    <div class="grid grid-cols-2 gap-4">
                        <div class="bg-gray-50 p-3 rounded-lg">
                            <label class="block text-sm font-medium text-gray-600">Object ID</label>
                            <p class="font-mono text-lg">#{{ object_info.object_id }}</p>
                        </div>
                        <div class="bg-gray-50 p-3 rounded-lg">
                            <label class="block text-sm font-medium text-gray-600">Class</label>
                            <p class="text-lg capitalize">{{ object_info.object_class }}</p>
                        </div>
                    </div>
                    
                    <div class="bg-gray-50 p-3 rounded-lg">
                        <label class="block text-sm font-medium text-gray-600">Trajectory Points</label>
                        <p class="text-lg">{{ object_info.trajectory_points|length }} points tracked</p>
                    </div>
                    
                    {% if object_info.analysis_summary %}
                    <div class="bg-blue-50 p-3 rounded-lg">
                        <label class="block text-sm font-medium text-blue-600">Analysis Summary</label>
                        <div class="text-sm text-blue-800 mt-2">
                            {% if object_info.analysis_summary.path_straightness %}
                            <p>Path Straightness: {{ "%.2f"|format(object_info.analysis_summary.path_straightness) }}</p>
                            {% endif %}
                            {% if object_info.analysis_summary.direction_variance %}
                            <p>Direction Variance: {{ "%.2f"|format(object_info.analysis_summary.direction_variance) }}</p>
                            {% endif %}
                        </div>
                    </div>
                    {% endif %}
                </div>

                <!-- Speed and Direction Charts -->
                {% if object_info.speed_data and object_info.speed_data|length > 1 %}
                <div class="mt-6">
                    <h3 class="text-lg font-semibold mb-3">Speed Over Time</h3>
                    <canvas id="speed-chart" height="150"></canvas>
                </div>
                {% endif %}

                {% if object_info.direction_data and object_info.direction_data|length > 1 %}
                <div class="mt-6">
                    <h3 class="text-lg font-semibold mb-3">Direction Changes</h3>
                    <canvas id="direction-chart" height="150"></canvas>
                </div>
                {% endif %}
            </div>
        </div>

        <!-- Raw Data Section -->
        <div class="mt-8 bg-white rounded-xl shadow-lg p-6">
            <h2 class="text-2xl font-semibold mb-4 flex items-center">
                <i class="fas fa-database text-purple-500 mr-3"></i>
                Raw Trajectory Data
            </h2>
            
            {% if object_info.trajectory_points and object_info.trajectory_points|length > 0 %}
            <div class="overflow-x-auto">
                <table class="w-full text-sm">
                    <thead>
                        <tr class="bg-gray-50">
                            <th class="px-3 py-2 text-left">Point</th>
                            <th class="px-3 py-2 text-left">X</th>
                            <th class="px-3 py-2 text-left">Y</th>
                            <th class="px-3 py-2 text-left">Frame</th>
                            <th class="px-3 py-2 text-left">Timestamp</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for point in object_info.trajectory_points[:10] %}
                        <tr class="border-b">
                            <td class="px-3 py-2 font-mono">{{ loop.index }}</td>
                            <td class="px-3 py-2">{{ "%.1f"|format(point[0]) if point[0] is number else point[0] }}</td>
                            <td class="px-3 py-2">{{ "%.1f"|format(point[1]) if point[1] is number else point[1] }}</td>
                            <td class="px-3 py-2">{{ point[2] if point|length > 2 else 'N/A' }}</td>
                            <td class="px-3 py-2">{{ "%.1f"|format(point[3]) if point|length > 3 and point[3] is number else 'N/A' }}</td>
                        </tr>
                        {% endfor %}
                        {% if object_info.trajectory_points|length > 10 %}
                        <tr>
                            <td colspan="5" class="px-3 py-2 text-center text-gray-500">
                                ... and {{ object_info.trajectory_points|length - 10 }} more points
                            </td>
                        </tr>
                        {% endif %}
                    </tbody>
                </table>
            </div>
            {% else %}
            <div class="text-center py-8 text-gray-500">
                <i class="fas fa-database text-3xl mb-2"></i>
                <p>No trajectory data available for display</p>
            </div>
            {% endif %}
        </div>
    </div>

    <script>
        // Initialize charts if data is available
        document.addEventListener('DOMContentLoaded', function() {
            {% if object_info.speed_data and object_info.speed_data|length > 1 %}
            createSpeedChart();
            {% endif %}
            
            {% if object_info.direction_data and object_info.direction_data|length > 1 %}
            createDirectionChart();
            {% endif %}
        });

        {% if object_info.speed_data and object_info.speed_data|length > 1 %}
        function createSpeedChart() {
            const ctx = document.getElementById('speed-chart').getContext('2d');
            const speeds = {{ object_info.speed_data|tojson }};
            
            new Chart(ctx, {
                type: 'line',
                data: {
                    labels: speeds.map((_, i) => i + 1),
                    datasets: [{
                        label: 'Speed (px/frame)',
                        data: speeds,
                        borderColor: 'rgb(75, 192, 192)',
                        tension: 0.1,
                        fill: false
                    }]
                },
                options: {
                    responsive: true,
                    scales: {
                        y: {
                            beginAtZero: true
                        }
                    }
                }
            });
        }
        {% endif %}

        {% if object_info.direction_data and object_info.direction_data|length > 1 %}
        function createDirectionChart() {
            const ctx = document.getElementById('direction-chart').getContext('2d');
            const directions = {{ object_info.direction_data|tojson }};
            
            new Chart(ctx, {
                type: 'line',
                data: {
                    labels: directions.map((_, i) => i + 1),
                    datasets: [{
                        label: 'Direction (degrees)',
                        data: directions,
                        borderColor: 'rgb(153, 102, 255)',
                        tension: 0.1,
                        fill: false
                    }]
                },
                options: {
                    responsive: true,
                    scales: {
                        y: {
                            beginAtZero: true
                        }
                    }
                }
            });
        }
        {% endif %}

        function downloadTrajectory() {
            const link = document.createElement('a');
            link.href = '/api/motion/object-trajectory/{{ object_info.job_id }}/{{ object_info.object_id }}';
            link.download = `trajectory-job-{{ object_info.job_id }}-object-{{ object_info.object_id }}.png`;
            link.click();
        }
    </script>
</body>
</html>
